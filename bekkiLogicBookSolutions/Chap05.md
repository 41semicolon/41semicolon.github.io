# 5.15: 形式化
1) ∀n n∈N → ∃m m∈N ∧ m>n
2) ∀p Prime(p) → ∀n∃m (n∈N ∧ m∈N ∧ n = n^p-p*m) なお述語Primeは教科書で定義したもの
3) ￢ Converge(an) なお述語Convergeは教科書で定義したもの

# 5.20: 自由変項・束縛変項
1) 自由: {x}, 束縛: {}
2) 自由: {y}, 束縛: {x,y,z}
3) 自由: {}, 束縛: {x}
4) 自由: {x,y}, 束縛: {x}
5) 自由: {}, 束縛: {x}

# 5.27: 衝突しそうな代入
定義5.23 での2つに場合分けを「不変パターン」「代入できるパターン」と呼ぶ。代入できるパターンの衝突回避条件を「条件A」, 「条件B」と名前をつける。

- ∀xF(f(x), y) [不変パターン]
- ∀yF(f(z), y) [条件A:NG 条件B:OK]
- ∀xF(f(y), z) [不変パターン]
- ∀yF(f(y), z) [条件A:OK 条件B:NG]
- ∀yF(f(y), z) [条件A:OK 条件B:OK]
- ∀z(F(f(x), z))[y/x] ≡ ∀zF(f(y), z) [条件A:NG 条件B:NG, 新たな変数z を導入]

# 5.30: 部分項
{1, 2, x}

# 5.32: ゲーデル数化の単射性
二つの記号列 s1s2..sn とt1t2....tm が同じ数値 a に対応付けられたとする。a の素因数分解の一意性により s1=t1, s2=t2, ... より、二つの記号列は同一である。

# 5.36: 代入での深さ不変性
任意の個数の変数に対する代入を S とおく。より一般化した言明「任意のφ, S に対して φ と φ[S] の深さが一致する」を示す方が簡単。

Step1[φが基本述語]: φ=θ(τ1,τ2,...)とする。dφ = dθ(τ1,..) = 1 だし、dSφ= dθ(τ1[S], τ2[S], ...) = 1 なので、深さは一致。

Step2[φが複合論理式]: φ の深さ未満の式で 示す式が成立すると仮定(IH)。φは真理関数によって書けるか、量化子によって書けるかのいずれかである。

Case2A[真理関数ρ]: φは、φより深さが小さいn個の式 φ1,φ2,...φn をつかって、φ = ρ(φ1,...) と書ける。dρ(φ1,φ2,...) = max(dφ1,dφ2,...dφn) = max(dφ[S], dφ2[S],...) = dρ(φ[S]) となり（max同士の等号にIHをn回利用）代入による深さは不変。

Case2B[量化子Q]: 量化子Q(=∀or∃)を使って、φ=Qζψ と書ける。φに代入S を行う際には、ζ, S に応じて場合分けが必要であるが、いずれの場合にも、Qζφ[S] = Qη ψ[S']　の形となる(定義5.34, 5.37)ので dφ[S] = 1+dψ[S'] = 1+dψ = dφ (最後の一つ前の等号にIHを利用)。

以上Step1,2 により示された。

# 5.39: 証明の補完
証明の「全称量化論理式∀ξφの場合:...」以降の記述に登場する∀という記号を∃という記号に機械的に置き換えたものが証明として成立する。

# 5.40: 代入と自由変数
Step1. [定項/変項] σが定数の場合自明に従う（fv(σ[τ/ξ])= {} = fv(σ)）。σが変数の場合は、σ=ξの時とそうでないときで場合分け。σ=ξの場合、示したい式の1番目のケースに該当するが、fv(σ[τ/ξ])=fv(τ), (fv(σ)-{ξ})∪fv(τ)={}∪fv(τ)=fv(τ) となるので、従う。σ≠ξの場合は示したい式の2番目のケースに該当するが、fv(σ[τ/ξ])=fv(σ)となるので従う。

Step2. [演算子g] 任意の n項演算子 gと 任意の n個の項 τ1, ...τn に対し、X = fv(g(τ1,τ2,..τn)[τ/ξ]) = fv(τ1[τ/ξ])∪fv(τ2[τ/ξ)..., Y = fv(g(τ1,τ2,..τn)) = fv(τ1)∪fv(τ2)... を場合分けして考える。

Case2A) 全ての i=1,2,...n に対し ξ∉fv(τi) の場合。示したい式の2番目に相当するので、X = Y を示せばよい。IHより、fv(τ1[τ/ξ]) =fv(τ1)などとなるので X= fv(τ1)∪fv(τ2)∪...fv(τn) = fv(g(τ1, τ2...τn)) = Y となり示せた。

Case2B) i=1,2,...n のいずれか一つ以上において ξ∉fv(τi)である場合。示したい式の1番目に相当するので、X = (Y-{ξ})∪fv(τ) を示せばよい。IHより X の該当箇所が (fv(τi)-{ξ})∪fv(τ) となり、それ以外の箇所は fv(τj) となる。∪の順序を入れ替えてfv(τ) を一番右側に持ってくる。何回 fv(τ) を和集合しても fv(τ) であるので、結局 X = (fv(τ1))∪...∪(fv(τj)-{ξ})...∪(fv(τn))∪fv(τ) = (Y-{ξ})∪fv(τ) となりこの場合でも示された。

以上Step1,2より示された

# 5.41: 代入と自由変数
Step1. [基本述語θ] φ=θ(τ1,τ2,...τn)とする。fv(φ[τ/ξ])=fv(θ(τ1[τ/ξ], τ2[τ/ξ], ...))=fv(τ1[τ/ξ])∪fv(τ2[τ/ξ])∪...となり項の自由変数の話に帰着。場合分け。Case1A: i=1,2,...n の1つ以上の i に対し ξ∈fv(τi) の場合。示すべき式の1行目に対応するが、各部分に5.40の結果を用いると同時に、5.40のStep2でやった議論を繰り返すと、上述の式は ((fv(τ1)∪fv(τ2)∪...)-{ξ})∪fv(τ) = (fv(θ(τ1,...))-{ξ})∪fv(τ) となり、示された。Case2B: i=1,2...nの全てについて ξ∈fv(τi)の場合。これは示すべきの2行目に対応するが、5.40の結果を用いると直ちに従う。

Step2. Case2A:[真理関数ρ] φ=ρ(φ1,..,φn)のとき。fv(ρ(..))=fv(φ1)∪fv(φ2)∪... となるが、IHを使うとほぼ自明にしたがう（Step1での項の論証が、ここで式の論証としてそのまま使える）。

Case2B:[量化子Q]。∀と∃で全く同じ論証が成り立つので Q とまとめて話を進める。

Case2B1:[ξで量化]。 ξ∈fv(φ)の場合、fv((Qξφ)[τ/ξ])=fv(Qξ φ[τ/ξ]) = fv(φ[τ/ξ])-{ξ} = (fv(φ)-{ξ})∪fv(τ) = fv(Qξφ)∪fv(τ) より示された(最後の一つ前の等号でIH)。ξ∉fv(φ)の場合、fv((Qξφ)[τ/ξ]) = fv(Qξ φ[τ/ξ]) = fv(φ[τ/ξ])-{ξ} = fv(φ)-{ξ} = fv(Qξφ) となり示された(最後の一つ前の等号でIH)。

Case2B2:[ζ≠ξで量化,非衝突] ξ∉fv(φ)またはζ∉fv(τ)の場合。fv((Qζφ)[τ/ξ]) = fv(Qζ φ[τ/ξ]) = fv(φ[τ/ξ])-{ζ} = fv(φ[τ/ξ])-{ζ} 。場合分け。ξ∉fv(φ)の場合、IHを使って計算を進めて、...= fv(φ)-{ζ} = fv(Qζφ) となり 示された。ξ∈fv(φ)の場合（Case2B2の前提よりζ∈fv(τ)となることに注意）、IHを使って計算を続けて ...= ((fv(φ)-{ξ})∪fv(τ))-{ζ} = (fv(Qζφ)-{ζ}-{ξ})∪(fv(τ)-{ζ}) = (fv(Qζφ)-{ξ})∪fv(τ) となり 示された。

Case2B3:[ζ≠ξで量化,衝突] ξ∈fv(φ) かつ ζ∈fv(τ)の場合。η∉fv(φ)∪fv(τ) なる変数ηを用いて、(Qζφ)[τ/ξ] = Qη φ[η/ζ][τ/ξ] 。よって fv((Qζφ)[τ/ξ]) = fv(φ[η/ζ][τ/ξ])-{η} となるが、ξ∈fv(φ[η/ζ]) なので(注：省略しているがこれもIHからの帰結) φ[η/ζ] に関するIHを使って計算を進めて、...= (fv(φ[η/ζ])-{ξ})∪fv(τ) -{η}
= (fv(Qηφ[η/ζ])-{ξ}-{η})∪(fv(τ) -{η})
= (fv(Qηφ[η/ζ])-{ξ})∪(fv(τ)-{η})
= (fv(Qζφ)-{ξ})∪fv(τ)
となり示せた（最後の等号に5.25を利用）。

以上Step1,2 から示せた。

# 5.43 代入に関する性質
問題1. Step1: [基本述語θ] φ=θ(τ1,..τn) としてよい。φ[ξ/ξ] = θ(τ1[ξ/ξ], ...)となるので、言明S:「任意の項τに対して τ[ξ/ξ]=τ」を示せばよい。言明Sについて項に関する帰納法を使えばよいがほぼ自明なのでその証明は略。

Step2: [複合論理式] Case2A: [真理関数ρ] ρ(φ1,..φm)[ξ/ξ] = ρ(φ1[ξ/ξ],...) = ρ(φ1,φ2, ...) となり示せた。Case2B: [ξで量化] (∀ξφ)[ξ/ξ]=∀ξ φ[ξ/ξ]=∀ξφ より示せた。Case2C: [ζ≠ξで量化,非衝突]（∀ζφ)[ξ/ξ]=∀ζ φ[ξ/ξ]=∀ζφ より示せた。Case2D: [ζ≠ξで量化,衝突] ζ∉fv(ξ) なので衝突しない。

以上Step1,2より示せた。  

---
問題2. 示すべきが A(φ) ⇒ B(φ) という形式で今までと違うので論証の方法に注意

Step1: [基本述語θ] φ=θ(τ1,..τn) とおく。fvφ= fv(τ1)∪fv(τ2)...であるので 示す式の前提は ξ∉fv(τi) ただしi=1,2,... となる。この下で φ[τ/ξ]=θ(τ1[τ/ξ], ...)=θ(τ1,τ2,...)=φ。よって示された。

Step2: Case2A[真理関数ρ]: fv(ρ(φ1,...))=fv(φ1)∪fv(φ2)...であるので、示す式の前提は ξ∉fv(φi) ただしi=1,2,... となる。これは、φi に関する IHの前提が成立することを示す。この下で ρ(φ1,..)[τ/ξ] = ρ(φ1[τ/ξ],...) = ρ(φ1,φ2, ...)。

Case2B[ξで量化]: fv(Qξφ)=fv(φ)-{ξ} により、示す式の前提から ξ∉fv(φ) が言える。これはφ に関するIH の前提を満たす。よって、(Qξφ)[τ/ξ] = Qξ φ[τ/ξ] = Qξφ となり示された。

Case2C[ζ≠ξで量化,非衝突]: fv(Qζφ)=fv(φ)-{ζ} により、示す式の前提から ξ∉fv(φ) が言える。これはφ に関するIH の前提を満たす。(Qζφ)[τ/ξ] = Qζ φ[τ/ξ] = Qζφ。

Case2C[ζ≠ξで量化,衝突]: 示すべき式の前提から、衝突しない。

---
問題3. 
ξ=ζの場合は、問題1,2 の結果より明らかに従うので、ξ≠ζとしてよい。

Step1: [基本述語θ] φ=θ(τ1,..τn) とおく。fvφ= fv(τ1)∪fv(τ2)...であるので 示す式の前提は ζ∉fv(τi) ただしi=1,2,... となる。この下で φ[ζ/ξ][τ/ζ] = θ(τ1[ζ/ξ][τ/ζ],..τn[ζ/ξ][τ/ζ])=θ(τ1[τ/ξ],τ2[τ/ξ],...)=φ[τ/ξ]。よって示された（項に関する言明「ζ∉fv(τ0) ⇒ τ0[ζ/ξ][τ/ζ] = τ0[τ/ξ]」を使ったが、これは別途証明が必要）。

Step2.
Case2A[真理関数ρ]: fv(ρ(φ1,...))=fv(φ1)∪fv(φ2)...であるので、示す式の前提は ζ∉fv(φi) ただしi=1,2,... となり、φi に関して IHの前提が満たされるので IHの帰結が使える。この下で ρ(φ1,..φm)[ζ/ξ][τ/ζ]=ρ(φ1[ζ/ξ][τ/ζ], ...) = ρ(φ1[τ/ξ], ...) = ρ(φ1,..φm)[τ/ξ]。

Case2B[ξで量化]: 仮定 ζ∉fv(Qξφ) と ξ≠ζ は ζ∉fv(φ) を含意するので、IHの帰結部 φ[ζ/ξ])[τ/ζ]=φ[τ/ζ] を使ってよい。よって、((Qξφ)[ζ/ξ])[τ/ζ] = (Qξφ)[τ/ζ] = Qξ φ[τ/ζ] = Qξφ。一方、(Qξφ)[τ/ξ] = Qξφ。 よって示された。

Case2C[ζで量化]: 仮定 ζ∉fv(Qζφ) は満たされえないので、示さなくてよい。

Case2D[η≠ξ,ζで量化]: ζ∉fv(Qηφ) を仮定。少し変形して ζ∉fvφ -{η} となるが、これは、η≠ζであるので ζ∉fvφを含意し、IHより φ[ζ/ξ][τ/ζ] = φ[τ/ξ] を使ってよい。

Case2D1:[非衝突] η∉fv(τ)またはξ∉fv(φ) の場合。(Qηφ)[τ/ξ] = Qη φ[τ/ξ]となる。一方、((Qηφ)[ζ/ξ])[τ/ζ] = (Qη φ[ζ/ξ])[τ/ζ]。η∉fv(τ)の時は計算がさらに進み = Qη φ[ζ/ξ][τ/ζ] = Qη φ[τ/ξ] となり示せる。ξ∉fv(φ) の時も、φ[ζ/ξ]=φ となるから計算が進み = (Qηφ)[τ/ζ] = Qη φ[τ/ζ] = Qηφ となり、右辺もさらに計算できて Qη φ[τ/ξ] = Qηφ となり一致する。

Case2D2:[衝突] η∈fv(τ)かつξ∈fv(φ)の時。v∉fv(τ)∪fv(φ)∪{ζ}なる 変数v を使うと、
((Qηφ)[ζ/ξ])[τ/ζ] 
= (Qη φ[ζ/ξ])[τ/ζ] 
= Qv φ[v/η][ζ/ξ][τ/ζ] 
ここで ζ∉fvφ (Case2Dに記載) は 5.41 を利用すると ζ∉fv(φ[v/η]) を含意するので、IH が使えて φ[v/η][ζ/ξ][τ/ζ] = φ[v/η][τ/ξ]。よって計算を進めて ..= Qv φ[v/η][τ/ξ] = (Qηφ)[τ/ξ] となり示された。
